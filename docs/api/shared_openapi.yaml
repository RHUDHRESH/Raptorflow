openapi: 3.1.0
info:
  title: RaptorFlow Shared API Spec
  version: 1.0.0
  description: |
    Shared OpenAPI specification for RaptorFlow client/server integration.
    All endpoints return the standard RaptorResponse envelope with consistent error codes and messages.
servers:
  - url: http://localhost:8000
    description: Local development
  - url: https://api.raptorflow.ai
    description: Production
paths:
  /:
    get:
      summary: Get system info
      tags: [system]
      responses:
        '200':
          description: System info response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemInfoResponse'
  /health:
    get:
      summary: Health check
      tags: [system]
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /agents:
    get:
      summary: List agents
      tags: [agents]
      responses:
        '200':
          description: List of agents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentListResponse'
        '500':
          $ref: '#/components/responses/StandardError'
  /agents/{agentId}:
    get:
      summary: Get agent
      tags: [agents]
      parameters:
        - in: path
          name: agentId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Agent detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '404':
          $ref: '#/components/responses/StandardError'
  /skills:
    get:
      summary: List skills
      tags: [skills]
      responses:
        '200':
          description: List of skills
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillListResponse'
        '500':
          $ref: '#/components/responses/StandardError'
  /skills/{skillId}:
    get:
      summary: Get skill
      tags: [skills]
      parameters:
        - in: path
          name: skillId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Skill detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillResponse'
        '404':
          $ref: '#/components/responses/StandardError'
  /tools:
    get:
      summary: List tools
      tags: [tools]
      responses:
        '200':
          description: List of tools
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolListResponse'
        '500':
          $ref: '#/components/responses/StandardError'
  /tools/{toolId}:
    get:
      summary: Get tool
      tags: [tools]
      parameters:
        - in: path
          name: toolId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Tool detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolResponse'
        '404':
          $ref: '#/components/responses/StandardError'
  /workflows:
    get:
      summary: List workflows
      tags: [workflows]
      responses:
        '200':
          description: List of workflows
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowListResponse'
        '500':
          $ref: '#/components/responses/StandardError'
  /workflows/{workflowId}:
    get:
      summary: Get workflow
      tags: [workflows]
      parameters:
        - in: path
          name: workflowId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Workflow detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowResponse'
        '404':
          $ref: '#/components/responses/StandardError'
components:
  responses:
    StandardError:
      description: Standard error envelope
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            notFound:
              summary: Not found
              value:
                success: false
                data: null
                error:
                  code: NOT_FOUND
                  message: The requested item was not found.
                meta:
                  timestamp: '2024-01-01T00:00:00.000Z'
  schemas:
    RaptorMeta:
      type: object
      required: [timestamp]
      properties:
        timestamp:
          type: string
          format: date-time
        requestId:
          type: string
          nullable: true
    RaptorError:
      type: object
      required: [code, message]
      properties:
        code:
          $ref: '#/components/schemas/ErrorCode'
        message:
          type: string
        details:
          nullable: true
    ErrorCode:
      type: string
      enum:
        - BAD_REQUEST
        - UNAUTHORIZED
        - FORBIDDEN
        - NOT_FOUND
        - INTERNAL_SERVER_ERROR
        - VALIDATION_ERROR
        - UNPROCESSABLE_ENTITY
        - AI_ENGINE_ERROR
        - RATE_LIMITED
        - NETWORK_ERROR
        - UNKNOWN_ERROR
      description: |
        Error codes used across endpoints. Messages are standardized in the client.
    ErrorResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [false]
        data:
          nullable: true
        error:
          $ref: '#/components/schemas/RaptorError'
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    SystemInfo:
      type: object
      properties:
        message:
          type: string
        version:
          type: string
        status:
          type: string
        modules:
          type: array
          items:
            type: string
    HealthStatus:
      type: object
      properties:
        status:
          type: string
        modules:
          type: object
          additionalProperties:
            type: string
    Agent:
      type: object
      required: [id, name, type, status, capabilities]
      properties:
        id:
          type: string
        name:
          type: string
        type:
          type: string
        status:
          type: string
        capabilities:
          type: array
          items:
            type: string
    Skill:
      type: object
      required: [id, name, category, status, description]
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string
        status:
          type: string
        description:
          type: string
    Tool:
      type: object
      required: [id, name, type, status, description]
      properties:
        id:
          type: string
        name:
          type: string
        type:
          type: string
        status:
          type: string
        description:
          type: string
    Workflow:
      type: object
      required: [id, name, status, steps, progress]
      properties:
        id:
          type: string
        name:
          type: string
        status:
          type: string
        steps:
          type: integer
        progress:
          type: number
    SystemInfoResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          $ref: '#/components/schemas/SystemInfo'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    HealthResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          $ref: '#/components/schemas/HealthStatus'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    AgentListResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          type: array
          items:
            $ref: '#/components/schemas/Agent'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    AgentResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          $ref: '#/components/schemas/Agent'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    SkillListResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          type: array
          items:
            $ref: '#/components/schemas/Skill'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    SkillResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          $ref: '#/components/schemas/Skill'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    ToolListResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          type: array
          items:
            $ref: '#/components/schemas/Tool'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    ToolResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          $ref: '#/components/schemas/Tool'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    WorkflowListResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          type: array
          items:
            $ref: '#/components/schemas/Workflow'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
    WorkflowResponse:
      type: object
      required: [success, data, error, meta]
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          $ref: '#/components/schemas/Workflow'
        error:
          nullable: true
        meta:
          $ref: '#/components/schemas/RaptorMeta'
