openapi: 3.1.0
info:
  title: RaptorFlow Backend API
  description: |
    Comprehensive API documentation for RaptorFlow backend with VertexAI integration.
    
    ## Overview
    RaptorFlow is an enterprise-grade AI-powered business intelligence platform that provides:
    - Multi-agent AI workflows with VertexAI integration
    - Cognitive engine for intelligent automation
    - Real-time analytics and monitoring
    - Enterprise security and compliance
    
    ## Authentication
    All API endpoints (except `/health` and `/auth/login`) require JWT authentication.
    
    ## Rate Limiting
    - Default: 100 requests/minute
    - Premium: 500 requests/minute  
    - Enterprise: 1000 requests/minute
    
    ## AI Providers
    - Primary: Google VertexAI (Gemini models)
    - Fallback: OpenAI (GPT models)
    - Additional: Anthropic Claude, HuggingFace
    
  version: 1.0.0
  contact:
    name: RaptorFlow API Support
    email: api-support@raptorflow.com
    url: https://docs.raptorflow.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api-staging.raptorflow.com
    description: Staging server
  - url: https://api.raptorflow.com
    description: Production server

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Users
    description: User management operations
  - name: Workspaces
    description: Workspace management
  - name: Agents
    description: AI agent operations
  - name: Workflows
    description: Workflow management
  - name: Cognitive
    description: Cognitive engine operations
  - name: Memory
    description: Memory storage and retrieval
  - name: Analytics
    description: Analytics and metrics
  - name: Health
    description: System health monitoring
  - name: Webhooks
    description: Webhook management

paths:
  /health:
    get:
      tags:
        - Health
      summary: Check system health
      description: Comprehensive health check of all system components
      operationId: getHealth
      responses:
        '200':
          description: System is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              examples:
                healthy:
                  $ref: '#/components/examples/HealthyResponse'

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and return JWT tokens
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              valid_login:
                $ref: '#/components/examples/ValidLogin'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                success:
                  $ref: '#/components/examples/AuthSuccess'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get new access token using refresh token
      operationId: refreshToken
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenRefreshResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /users/me:
    get:
      tags:
        - Users
      summary: Get current user profile
      description: Retrieve the current user's profile information
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    put:
      tags:
        - Users
      summary: Update user profile
      description: Update the current user's profile information
      operationId: updateCurrentUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
      responses:
        '200':
          description: User profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '422':
          $ref: '#/components/responses/ValidationError'

  /workspaces:
    get:
      tags:
        - Workspaces
      summary: List user workspaces
      description: Retrieve all workspaces belonging to the current user
      operationId: listWorkspaces
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          description: Items per page
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Workspaces retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceListResponse'

    post:
      tags:
        - Workspaces
      summary: Create workspace
      description: Create a new workspace
      operationId: createWorkspace
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceCreateRequest'
      responses:
        '201':
          description: Workspace created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspace'
        '422':
          $ref: '#/components/responses/ValidationError'

  /workspaces/{workspace_id}:
    get:
      tags:
        - Workspaces
      summary: Get workspace details
      description: Retrieve detailed information about a specific workspace
      operationId: getWorkspace
      security:
        - bearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          description: Workspace ID
          schema:
            type: string
      responses:
        '200':
          description: Workspace retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspace'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags:
        - Workspaces
      summary: Update workspace
      description: Update workspace information
      operationId: updateWorkspace
      security:
        - bearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          description: Workspace ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceUpdateRequest'
      responses:
        '200':
          description: Workspace updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspace'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Workspaces
      summary: Delete workspace
      description: Delete a workspace and all associated data
      operationId: deleteWorkspace
      security:
        - bearerAuth: []
      parameters:
        - name: workspace_id
          in: path
          required: true
          description: Workspace ID
          schema:
            type: string
      responses:
        '200':
          description: Workspace deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        services:
          type: object
          properties:
            database:
              $ref: '#/components/schemas/ServiceHealth'
            redis:
              $ref: '#/components/schemas/ServiceHealth'
            vertexai:
              $ref: '#/components/schemas/ServiceHealth'
            cognitive:
              $ref: '#/components/schemas/ServiceHealth'
        version:
          type: string
        uptime:
          type: number
          format: float

    ServiceHealth:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        response_time:
          type: number
          format: float
        last_check:
          type: string
          format: date-time

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User email address
        password:
          type: string
          format: password
          description: User password
        remember_me:
          type: boolean
          default: false
          description: Remember login session

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            access_token:
              type: string
              description: JWT access token
            refresh_token:
              type: string
              description: JWT refresh token
            token_type:
              type: string
              enum: [bearer]
            expires_in:
              type: integer
              description: Token expiration time in seconds
            user:
              $ref: '#/components/schemas/UserProfile'

    UserProfile:
      type: object
      properties:
        id:
          type: string
          description: User ID
        email:
          type: string
          format: email
        name:
          type: string
        subscription_tier:
          type: string
          enum: [free, pro, enterprise]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        preferences:
          type: object
          properties:
            theme:
              type: string
              enum: [light, dark, auto]
            notifications:
              type: boolean
            language:
              type: string

    UserUpdateRequest:
      type: object
      properties:
        name:
          type: string
        preferences:
          type: object
          properties:
            theme:
              type: string
              enum: [light, dark, auto]
            notifications:
              type: boolean
            language:
              type: string

    Workspace:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        subscription_tier:
          type: string
          enum: [free, pro, enterprise]
        status:
          type: string
          enum: [active, inactive, suspended]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        settings:
          type: object
          properties:
            ai_provider:
              type: string
              enum: [vertexai, openai, anthropic]
            model_preferences:
              type: object

    WorkspaceCreateRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type: string
          maxLength: 500
        subscription_tier:
          type: string
          enum: [free, pro, enterprise]
          default: free

    WorkspaceUpdateRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type: string
          maxLength: 500

    WorkspaceListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            workspaces:
              type: array
              items:
                $ref: '#/components/schemas/Workspace'
            pagination:
              $ref: '#/components/schemas/Pagination'

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        pages:
          type: integer

    TokenRefreshResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            access_token:
              type: string
            token_type:
              type: string
              enum: [bearer]
            expires_in:
              type: integer

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        timestamp:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
        timestamp:
          type: string
          format: date-time

  examples:
    HealthyResponse:
      summary: System is healthy
      value:
        status: healthy
        timestamp: "2024-01-01T00:00:00Z"
        services:
          database:
            status: healthy
            response_time: 0.023
            last_check: "2024-01-01T00:00:00Z"
          redis:
            status: healthy
            response_time: 0.015
            last_check: "2024-01-01T00:00:00Z"
          vertexai:
            status: healthy
            response_time: 0.045
            last_check: "2024-01-01T00:00:00Z"
          cognitive:
            status: healthy
            response_time: 0.032
            last_check: "2024-01-01T00:00:00Z"
        version: "1.0.0"
        uptime: 86400.0

    ValidLogin:
      summary: Valid login credentials
      value:
        email: "user@example.com"
        password: "password123"
        remember_me: false

    AuthSuccess:
      summary: Successful authentication
      value:
        success: true
        data:
          access_token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
          refresh_token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
          token_type: "bearer"
          expires_in: 1800
          user:
            id: "user_123"
            email: "user@example.com"
            name: "John Doe"
            subscription_tier: "pro"
            created_at: "2024-01-01T00:00:00Z"

  responses:
    UnauthorizedError:
      description: Authentication failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            unauthorized:
              value:
                success: false
                error:
                  code: AUTHENTICATION_ERROR
                  message: "Invalid credentials"
                timestamp: "2024-01-01T00:00:00Z"

    ValidationError:
      description: Validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            validation_error:
              value:
                success: false
                error:
                  code: VALIDATION_ERROR
                  message: "Invalid input data"
                  details:
                    field: "email"
                    issue: "Invalid email format"
                timestamp: "2024-01-01T00:00:00Z"

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            not_found:
              value:
                success: false
                error:
                  code: NOT_FOUND
                  message: "Resource not found"
                timestamp: "2024-01-01T00:00:00Z"
