openapi: 3.0.3
info:
  title: RaptorFlow Agentic Marketing OS API v2
  description: |
    The next-generation agentic marketing platform powered by 36 specialized agents,
    LangGraph orchestration, and intelligent token management.
  version: 2.0.0
  contact:
    name: RaptorFlow Team
    email: team@raptorflow.in

servers:
  - url: https://api.raptorflow.in/v2
    description: Production server
  - url: http://localhost:3001/api/v2
    description: Development server

security:
  - bearerAuth: []

paths:
  /plan:
    post:
      summary: Plan a marketing workflow
      description: |
        Create an execution plan for a marketing goal using the 36-agent roster.
        The orchestrator analyzes the goal and creates an optimized workflow.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - goal
              properties:
                goal:
                  type: string
                  description: The marketing objective (e.g., "Launch B2B SaaS campaign")
                  example: "Create awareness campaign for our new AI product"
                campaign_context:
                  type: object
                  description: Existing campaign data
                icp_context:
                  type: object
                  description: Target audience information
                budget_limit:
                  type: number
                  description: Maximum token budget
                  default: 50000
      responses:
        '200':
          description: Plan created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  plan_id:
                    type: string
                  execution_plan:
                    type: array
                    items:
                      type: object
                      properties:
                        department:
                          type: string
                          enum: [market_intelligence, offer_positioning, moves_campaigns, creative, distribution, analytics, memory_learning, safety_quality]
                        agents:
                          type: array
                          items:
                            type: string
                        estimated_tokens:
                          type: number
                        priority:
                          type: string
                          enum: [high, medium, low]
                  estimated_cost:
                    type: number
                  estimated_duration:
                    type: string
        '400':
          description: Invalid request
        '401':
          description: Unauthorized

  /execute:
    post:
      summary: Execute a planned workflow
      description: |
        Execute the planned workflow using LangGraph orchestration.
        All 36 agents coordinate to deliver the final marketing package.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - plan_id
              properties:
                plan_id:
                  type: string
                  description: Plan ID from /plan endpoint
                async:
                  type: boolean
                  description: Execute asynchronously
                  default: false
      responses:
        '200':
          description: Execution started/completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  execution_id:
                    type: string
                  status:
                    type: string
                    enum: [running, completed, failed]
                  progress:
                    type: number
                    description: Progress percentage (0-100)
                  results:
                    type: object
                    description: Final marketing package when completed
        '202':
          description: Execution started asynchronously
        '404':
          description: Plan not found

  /status/{execution_id}:
    get:
      summary: Get workflow execution status
      parameters:
        - name: execution_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  execution_id:
                    type: string
                  status:
                    type: string
                    enum: [initializing, planning, executing, validating, completing, error, dead_end]
                  progress_percentage:
                    type: number
                  current_step:
                    type: string
                  completed_agents:
                    type: array
                    items:
                      type: string
                  failed_agents:
                    type: array
                    items:
                      type: string
                  token_usage:
                    type: object
                    properties:
                      used:
                        type: number
                      remaining:
                        type: number
                      total:
                        type: number
                  budget_alerts:
                    type: array
                    items:
                      type: object
                      properties:
                        level:
                          type: string
                          enum: [warning, critical]
                        message:
                          type: string

  /feedback:
    post:
      summary: Submit user feedback
      description: |
        Capture user feedback on agent outputs for preference learning
        and continuous improvement.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - execution_id
                - agent_name
                - feedback_type
              properties:
                execution_id:
                  type: string
                agent_name:
                  type: string
                feedback_type:
                  type: string
                  enum: [thumbs_up, thumbs_down, edit, regenerate]
                feedback_text:
                  type: string
                  description: Optional detailed feedback
                original_output:
                  type: string
                  description: Original agent output
                edited_output:
                  type: string
                  description: User-edited version (if applicable)
      responses:
        '200':
          description: Feedback recorded
        '400':
          description: Invalid feedback data

  /agents:
    get:
      summary: List all available agents
      responses:
        '200':
          description: Agent roster retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  departments:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
                  total_agents:
                    type: number
                  agents_by_department:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        count:
                          type: number
                        agents:
                          type: array
                          items:
                            type: string

  /tools:
    get:
      summary: List available tools
      responses:
        '200':
          description: Tool registry retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  tools:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        description:
                          type: string
                        cost_estimate:
                          type: number
                  total_tools:
                    type: number

  /budget/{workflow_id}:
    get:
      summary: Get budget status for workflow
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Budget status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: number
                  used:
                    type: number
                  remaining:
                    type: number
                  alerts:
                    type: array
                    items:
                      type: string

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    AgentIO:
      type: object
      properties:
        inputs:
          type: object
        outputs:
          type: object
        metadata:
          type: object
          properties:
            agent_name:
              type: string
            execution_time:
              type: number
            token_usage:
              type: number
            cost_estimate:
              type: number
            model_used:
              type: string
            success:
              type: boolean
            errors:
              type: array
              items:
                type: string
            timestamp:
              type: string

    WorkflowExecution:
      type: object
      properties:
        execution_id:
          type: string
        status:
          type: string
        progress_percentage:
          type: number
        results:
          type: object
        token_budget:
          type: object
          properties:
            used:
              type: number
            remaining:
              type: number
        execution_metadata:
          type: object
          properties:
            start_time:
              type: string
            estimated_completion:
              type: string
            current_step:
              type: string

  examples:
    PlanRequest:
      value:
        goal: "Launch awareness campaign for our B2B SaaS product"
        campaign_context:
          name: "Q1 Growth Campaign"
          goal: "velocity"
        icp_context:
          label: "Mid-size Tech Companies"
          firmographics:
            company_size: "51-200"
            industry: "Technology"

    FeedbackRequest:
      value:
        execution_id: "exec_12345"
        agent_name: "copywriter_agent"
        feedback_type: "edit"
        feedback_text: "Make it more conversational and add urgency"
        original_output: "Our product helps you save time."
        edited_output: "Stop wasting hours on manual tasks. Our AI does it in minutes."


