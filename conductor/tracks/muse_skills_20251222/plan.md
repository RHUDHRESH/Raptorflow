# Plan: End-to-End Muse with Agent Skills

## Phase 1: Core Infrastructure & Dependencies
- [x] **Task 1.1: Install AI & Data dependencies**
    - [x] Install `@langchain/core`, `@langchain/google-vertexai`, `@langchain/langgraph`, `@langchain/community`.
    - [x] Install `@supabase/supabase-js`.
    - [x] Install database-specific checkpointing for LangGraph (e.g., `@langchain/langgraph-checkpoint-postgres`).
- [x] **Task 1.2: Supabase Schema Preparation**
    - [x] Create `skills` table (id, name, description, instructions, type, created_at).
    - [x] Create `muse_assets` table for vector storage (id, content, metadata, embedding).
    - [x] Enable `pgvector` extension and create vector index.
    - [x] Set up LangGraph checkpointing tables (if not handled automatically by helper).
- [x] **Task 1.3: Vertex AI Client Configuration**
    - [x] Create `src/lib/vertexai.ts` to initialize Gemini 2.0/1.5 models.
    - [x] Set up environment variables for GCP Project, Location, and Credentials.
- [x] **Task: Conductor - User Manual Verification 'Phase 1: Core Infrastructure & Dependencies' (Protocol in workflow.md)** [checkpoint: 0e43b54]

## Phase 2: Skills Architecture & Management
- [ ] **Task 2.1: Skill System Registry**
    - [ ] Create `src/lib/muse/skills-manager.ts`.
    - [ ] Implement `loadSystemSkills()` to read from `src/skills/system/*.md`.
    - [ ] Implement `loadCustomSkills()` to fetch from Supabase.
- [ ] **Task 2.2: Skill-to-Tool Transformer**
    - [ ] Implement utility to convert a Skill definition into a LangChain `@tool` or `DynamicTool`.
- [ ] **Task 2.3: Implement first 3 Core Skills (Validation)**
    - [ ] Create `src/skills/system/positioning-refiner.md`.
    - [ ] Create `src/skills/system/linkedin-thought-leader.md`.
    - [ ] Create `src/skills/system/brand-voice-guardian.md`.
- [ ] **Task: Conductor - User Manual Verification 'Phase 2: Skills Architecture & Management' (Protocol in workflow.md)**

## Phase 3: LangGraph Orchestration (The Agent)
- [ ] **Task 3.1: Define Graph State & Nodes**
    - [ ] Create `src/lib/muse/agent.ts`.
    - [ ] Define `MuseState` (messages, current_skill, context).
    - [ ] Implement `router` node (decides if a skill is needed).
    - [ ] Implement `call_skill` node.
- [ ] **Task 3.2: Persistence & Memory**
    - [ ] Integrate `PostgresSaver` with Supabase/Postgres to persist chat sessions.
- [ ] **Task 3.3: RAG Implementation**
    - [ ] Implement `retrieve_context` tool using Supabase vector search.
    - [ ] Integrate into the graph to provide "Brand Voice" context.
- [ ] **Task: Conductor - User Manual Verification 'Phase 3: LangGraph Orchestration (The Agent)' (Protocol in workflow.md)**

## Phase 4: API & Frontend Integration
- [ ] **Task 4.1: Muse Chat API Route**
    - [ ] Create `src/app/api/muse/chat/route.ts`.
    - [ ] Implement streaming response using `langchain/callbacks`.
- [ ] **Task 4.2: Frontend Chat Component Enhancements**
    - [ ] Update `src/components/muse/MuseChat.tsx` to handle streaming and Skill-based responses.
    - [ ] Add "Thinking..." / "Using Skill: [Name]" indicators.
- [ ] **Task 4.3: Custom Skill Editor**
    - [ ] Create `src/components/muse/SkillEditor.tsx` to allow users to save new skills to Supabase.
- [ ] **Task: Conductor - User Manual Verification 'Phase 4: API & Frontend Integration' (Protocol in workflow.md)**

## Phase 5: Finalization of Comprehensive System Skills
- [ ] **Task 5.1: Implement Core Strategy Skills**
    - [ ] `icp-profiler.md`, `story-extractor.md`, `landing-page-critic.md`.
- [ ] **Task 5.2: Implement Text Asset Skills**
    - [ ] `cold-outreach-sculptor.md`, `newsletter-architect.md`.
    - [ ] `tagline-generator.md`, `video-script-writer.md`.
    - [ ] `social-post-architect.md` (combining LinkedIn/Twitter logic).
    - [ ] `product-storyteller.md`, `naming-expert.md`.
    - [ ] `lead-magnet-creator.md`, `sales-script-writer.md`.
- [ ] **Task 5.3: Implement Visual Asset Skills**
    - [ ] `meme-generator.md` (Concept generation).
    - [ ] `social-card-designer.md` (Layout description).
    - [ ] `wireframe-architect.md` (Structure definition).
- [ ] **Task 5.4: Implement Utility Skills**
    - [ ] `content-repurposer.md`.
- [ ] **Task 5.5: End-to-End Verification**
    - [ ] Verify that EVERY asset type in `types.ts` can be generated by at least one skill.
    - [ ] Verify Skill switching logic accurately routes "I need a meme" to `meme-generator`.
- [ ] **Task: Conductor - User Manual Verification 'Phase 5: Finalization of Comprehensive System Skills' (Protocol in workflow.md)**
